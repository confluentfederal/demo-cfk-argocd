# Default values for confluent-platform
# This is the base configuration - override in values-dev.yaml or values-prod.yaml

# Create namespace (set to false if namespace already exists or managed externally)
createNamespace: true

# Global image settings
global:
  cpVersion: "8.1.0"
  initVersion: "3.1.0"

# KRaft Controller (replaces Zookeeper)
kraftController:
  enabled: true
  replicas: 3
  image:
    application: confluentinc/cp-server:8.1.0
    init: confluentinc/confluent-init-container:3.1.0
  dataVolumeCapacity: 10Gi
  configOverrides: {}

# Kafka Cluster
kafka:
  enabled: true
  replicas: 3
  image:
    application: confluentinc/cp-server:8.1.0
    init: confluentinc/confluent-init-container:3.1.0
  dataVolumeCapacity: 10Gi
  metricReporter:
    enabled: true
  configOverrides: {}

# Schema Registry
schemaRegistry:
  enabled: true
  replicas: 1
  image:
    application: confluentinc/cp-schema-registry:8.1.0
    init: confluentinc/confluent-init-container:3.1.0
  configOverrides: {}

# Kafka Connect
connect:
  enabled: true
  replicas: 2
  image:
    application: confluentinc/cp-server-connect:8.1.0
    init: confluentinc/confluent-init-container:3.1.0
  plugins:
    - name: kafka-connect-datagen
      owner: confluentinc
      version: "0.6.5"
    - name: kafka-connect-jdbc
      owner: confluentinc
      version: "10.8.0"
  configOverrides: {}

# ksqlDB
ksqldb:
  enabled: true
  replicas: 1
  image:
    application: confluentinc/cp-ksqldb-server:8.1.0
    init: confluentinc/confluent-init-container:3.1.0
  dataVolumeCapacity: 10Gi
  configOverrides: {}
  
  # ksqlDB Queries
  queries:
    enabled: true
    items:
      # Clickstream Raw - reads from datagen clickstream data
      01-clickstream-raw.sql: |
        CREATE STREAM IF NOT EXISTS clickstream_raw (
          ip VARCHAR,
          userid INT,
          remote_user VARCHAR,
          time VARCHAR,
          _time INT,
          request VARCHAR,
          status VARCHAR,
          bytes VARCHAR,
          referrer VARCHAR,
          agent VARCHAR
        ) WITH (
          KAFKA_TOPIC='network-events',
          VALUE_FORMAT='JSON'
        );
      # Requests by Status - aggregates requests by HTTP status code
      02-requests-by-status.sql: |
        CREATE TABLE IF NOT EXISTS requests_by_status AS
        SELECT 
          status,
          COUNT(*) AS request_count
        FROM clickstream_raw
        WINDOW TUMBLING (SIZE 1 MINUTE)
        GROUP BY status
        EMIT CHANGES;
      # Top IPs - identifies most active IP addresses
      03-top-ips.sql: |
        CREATE TABLE IF NOT EXISTS top_ips AS
        SELECT 
          ip,
          COUNT(*) AS request_count
        FROM clickstream_raw
        WINDOW TUMBLING (SIZE 5 MINUTES)
        GROUP BY ip
        EMIT CHANGES;

# Control Center
controlCenter:
  enabled: true
  replicas: 1
  image:
    application: confluentinc/cp-enterprise-control-center-next-gen:2.3.1
    init: confluentinc/confluent-init-container:3.1.0
  dataVolumeCapacity: 10Gi
  externalAccess:
    enabled: false
    type: nodePort
    nodePort:
      host: ""
      nodePortOffset: 30021
  cmf:
    enabled: true
    url: http://cmf-service.confluent.svc.cluster.local:80
  configOverrides:
    server: []

# Connectors - Disabled in platform chart, managed separately
connectors:
  enabled: false
  items: []

# Kafka Streams Demo App
kstreamsApp:
  enabled: true
  name: pageview-enricher
  replicas: 2
  image: confluentinc/cp-kafka:8.1.0
  applicationId: pageview-enricher-v1
  inputTopic: ENRICHED_PAGEVIEWS
  outputTopic: processed-pageviews
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Flink
flink:
  enabled: true
  cmf:
    endpoint: http://cmf-service.confluent.svc.cluster.local:80
  environment:
    name: flink-env
    flinkConfiguration:
      taskmanager.numberOfTaskSlots: "2"
      rest.profiling.enabled: "true"
  # Applications are now managed as separate ArgoCD apps
  # See charts/flink-application/ and argocd/applications/flink-*.yaml
  applications: []

# Content Router - Managed as separate chart
# See charts/content-router/
